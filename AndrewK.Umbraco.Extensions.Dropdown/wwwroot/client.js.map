{"version":3,"file":"client.js","sources":["../client/src/property-editor-ui-ak-dropdown.element.ts"],"sourcesContent":["import { css, customElement, html, map, nothing, property, state } from '@umbraco-cms/backoffice/external/lit';\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event'\nimport { UUISelectElement } from '@umbraco-cms/backoffice/external/uui';\nimport type {\n\tUmbPropertyEditorConfigCollection,\n\tUmbPropertyEditorUiElement,\n} from '@umbraco-cms/backoffice/property-editor';\nimport type { UUISelectEvent } from '@umbraco-cms/backoffice/external/uui';\n\n@customElement('ak-property-editor-ui-dropdown')\nexport class UmbPropertyEditorUIDropdownElement extends UmbLitElement implements UmbPropertyEditorUiElement {\n\t#selection: Array<string> = [];\n\n\t@property({ type: Array })\n\tpublic set value(value: Array<string> | string | undefined) {\n\t\tthis.#selection = Array.isArray(value) ? value : value ? [value] : [];\n\t}\n\tpublic get value(): Array<string> | undefined {\n\t\treturn this.#selection;\n\t}\n\n\t@property({ type: Boolean, reflect: true }) readonly = false;\n\n\tpublic set config(config: UmbPropertyEditorConfigCollection | undefined) {\n\t\tconsole.warn('config', config)\n\t\tif (!config) return;\n\t\t\n\t\tconsole.warn('config', config)\n\n\t\tconst items: Array<{ key: string, value: string }> | undefined = config.getValueByAlias('items');\n\t\tconst defaultValue: string | undefined = config.getValueByAlias('default');\n\n\t\tconsole.warn('before default')\n\t\tif (!!defaultValue && this.#selection.length === 0) {\n\t\t\tconsole.warn('setting default: ', defaultValue)\n\t\t\tthis.#selection.push(defaultValue);\n\t\t\t//this.#setValue([defaultValue]);\n\t\t}\n\n\t\tif (Array.isArray(items) && items.length > 0) {\n\t\t\tthis._options = items.map((item) => ({\n\t\t\t\tname: item.value,\n\t\t\t\tvalue: item.key,\n\t\t\t\tselected: this.#selection.includes(item.key)\n\t\t\t}));\n\n\t\t\t// If selection includes a value not in the list, add it to the list\n\t\t\tthis.#selection.forEach((value) => {\n\t\t\t\tif (!this._options.find((item) => item.value === value)) {\n\t\t\t\t\tthis._options.push({\n\t\t\t\t\t\tname: `${value} (${this.localize.term('validation_legacyOption')})`,\n\t\t\t\t\t\tvalue,\n\t\t\t\t\t\tselected: true,\n\t\t\t\t\t\tinvalid: true,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis._multiple = config.getValueByAlias<boolean>('multiple') ?? false;\n\t}\n\n\t@state() private _multiple: boolean = false;\n\n\t@state() private _options: Array<Option & { invalid?: boolean }> = [];\n\n\t#onChange(event: UUISelectEvent) {\n\t\tconst value = event.target.value as string;\n\t\tconsole.warn('value', value);\n\t\tthis.#setValue(value ? [value] : []);\n\t}\n\n\t#onChangeMultiple(event: Event & { target: HTMLSelectElement }) {\n\t\tconst selected = event.target.selectedOptions;\n\t\tconst value = selected ? Array.from(selected).map((option) => option.value) : [];\n\t\tthis.#setValue(value);\n\t}\n\n\t#setValue(value: Array<string> | string | null | undefined) {\n\t\tif (!value) return;\n\t\tthis.value = value;\n\t\tthis.dispatchEvent(new UmbChangeEvent());\n\t}\n\n\toverride render() {\n\t\treturn this._multiple ? this.#renderDropdownMultiple() : this.#renderDropdownSingle();\n\t}\n\n\t#renderDropdownMultiple() {\n\t\tif (this.readonly) {\n\t\t\treturn html`<div>${this.value?.join(', ')}</div>`;\n\t\t}\n\n\t\treturn html`\n\t\t\t<select id=\"native\" multiple @change=${this.#onChangeMultiple}>\n\t\t\t\t${map(\n\t\t\t\t\tthis._options,\n\t\t\t\t\t(item) => html`\n\t\t\t\t\t\t<option value=${item.value} ?selected=${item.selected}>${item.name}</option>\n\t\t\t\t\t`,\n\t\t\t\t)}\n\t\t\t</select>\n\t\t\t${this.#renderDropdownValidation()}\n\t\t`;\n\t}\n\n\t#renderDropdownSingle() {\n\t\treturn html`\n\t\t\t<umb-input-dropdown-list\n\t\t\t\t.options=${this._options}\n\t\t\t\t@change=${this.#onChange}\n\t\t\t\t?readonly=${this.readonly}></umb-input-dropdown-list>\n\t\t\t${this.#renderDropdownValidation()}\n\t\t`;\n\t}\n\n\t#renderDropdownValidation() {\n\t\tconst selectionHasInvalids = this.#selection.some((value) => {\n\t\t\tconst option = this._options.find((item) => item.value === value);\n\t\t\treturn option ? option.invalid : false;\n\t\t});\n\n\t\tif (selectionHasInvalids) {\n\t\t\treturn html`<div class=\"error\"><umb-localize key=\"validation_legacyOptionDescription\"></umb-localize></div>`;\n\t\t}\n\n\t\treturn nothing;\n\t}\n\n\tstatic override readonly styles = [\n\t\tUUISelectElement.styles,\n\t\tcss`\n\t\t\t#native {\n\t\t\t\theight: auto;\n\t\t\t}\n\n\t\t\t.error {\n\t\t\t\tcolor: var(--uui-color-danger);\n\t\t\t\tfont-size: var(--uui-font-size-small);\n\t\t\t}\n\t\t`,\n\t];\n}\n\nexport default UmbPropertyEditorUIDropdownElement;\n\ndeclare global {\n\tinterface HTMLElementTagNameMap {\n\t\t'ak-property-editor-ui-dropdown': UmbPropertyEditorUIDropdownElement;\n\t}\n}\n"],"names":["_selection","_UmbPropertyEditorUIDropdownElement_instances","onChange_fn","onChangeMultiple_fn","setValue_fn","renderDropdownMultiple_fn","renderDropdownSingle_fn","renderDropdownValidation_fn","UmbPropertyEditorUIDropdownElement","UmbLitElement","__privateAdd","value","__privateSet","__privateGet","config","items","defaultValue","item","__privateMethod","event","selected","option","UmbChangeEvent","html","_a","map","nothing","UUISelectElement","css","__decorateClass","property","state","customElement","UmbPropertyEditorUIDropdownElement$1"],"mappings":"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"}